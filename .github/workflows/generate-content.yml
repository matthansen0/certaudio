name: Generate Content

on:
  workflow_dispatch:
    inputs:
      certificationId:
        description: 'Microsoft certification ID'
        required: true
        type: choice
        options:
          # === AZURE ===
          - az-900     # Azure Fundamentals
          - az-104     # Azure Administrator
          - az-204     # Azure Developer
          - az-305     # Azure Solutions Architect Expert
          - az-400     # Azure DevOps Engineer Expert
          - az-500     # Azure Security Engineer
          - az-700     # Azure Network Engineer
          - az-140     # Azure Virtual Desktop Specialty
          - az-800     # Windows Server Hybrid Administrator (exam 1)
          - az-801     # Windows Server Hybrid Administrator (exam 2)
          # === AI & DATA ===
          - ai-900     # Azure AI Fundamentals
          - ai-102     # Azure AI Engineer
          - dp-900     # Azure Data Fundamentals
          - dp-100     # Azure Data Scientist
          - dp-203     # Azure Data Engineer
          - dp-300     # Azure Database Administrator
          - dp-600     # Microsoft Fabric Analytics Engineer
          - dp-700     # Microsoft Fabric Data Engineer (if available)
          # === SECURITY ===
          - sc-900     # Security, Compliance, Identity Fundamentals
          - sc-100     # Cybersecurity Architect Expert
          - sc-200     # Security Operations Analyst
          - sc-300     # Identity and Access Administrator
          - sc-400     # Information Protection and Compliance Admin
          # === MICROSOFT 365 ===
          - ms-900     # Microsoft 365 Fundamentals
          - ms-102     # Microsoft 365 Administrator
          - ms-700     # Microsoft Teams Administrator
          - md-102     # Endpoint Administrator
          # === POWER PLATFORM ===
          - pl-900     # Power Platform Fundamentals
          - pl-100     # Power Platform App Maker
          - pl-200     # Power Platform Functional Consultant
          - pl-300     # Power BI Data Analyst
          - pl-400     # Power Platform Developer
          - pl-500     # Power Automate RPA Developer
          - pl-600     # Power Platform Solution Architect Expert
          # === DYNAMICS 365 ===
          - mb-910     # Dynamics 365 Fundamentals (CRM)
          - mb-920     # Dynamics 365 Fundamentals (ERP)
          - mb-210     # Dynamics 365 Sales Functional Consultant
          - mb-220     # Dynamics 365 Customer Insights - Journeys
          - mb-230     # Dynamics 365 Customer Service
          - mb-240     # Dynamics 365 Field Service
          - mb-260     # Dynamics 365 Customer Insights - Data
          - mb-300     # Dynamics 365 Core Finance and Operations
          - mb-310     # Dynamics 365 Finance Functional Consultant
          - mb-330     # Dynamics 365 Supply Chain Management
          - mb-335     # Dynamics 365 Supply Chain Management Expert
          - mb-500     # Dynamics 365 Finance & Operations Apps Developer
          - mb-700     # Dynamics 365 Finance & Operations Solution Architect
          - mb-800     # Dynamics 365 Business Central Functional Consultant
          - mb-820     # Dynamics 365 Business Central Developer
        default: 'ai-102'
      audioFormat:
        description: 'Audio format'
        required: true
        type: choice
        options:
          - instructional
          - podcast
        default: 'instructional'
      examPageUrl:
        description: 'Override exam page URL (optional, auto-discovered if empty)'
        required: false
        default: ''

permissions:
  id-token: write
  contents: read

env:
  AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
  AZURE_RESOURCE_GROUP: ${{ secrets.AZURE_RESOURCE_GROUP }}

# =============================================================================
# REQUIRED SECRETS (configure in GitHub Settings > Secrets > Actions):
# - AZURE_CLIENT_ID:        Service principal/app registration client ID
# - AZURE_TENANT_ID:        Azure AD tenant ID  
# - AZURE_SUBSCRIPTION_ID:  Azure subscription ID
# - AZURE_RESOURCE_GROUP:   Resource group name (e.g., rg-certaudio-dev)
# =============================================================================

jobs:
  check-secrets:
    name: Validate Required Secrets
    runs-on: ubuntu-latest
    steps:
      - name: Check required secrets are configured
        run: |
          missing=""
          if [ -z "${{ secrets.AZURE_CLIENT_ID }}" ]; then missing="$missing AZURE_CLIENT_ID"; fi
          if [ -z "${{ secrets.AZURE_TENANT_ID }}" ]; then missing="$missing AZURE_TENANT_ID"; fi
          if [ -z "${{ secrets.AZURE_SUBSCRIPTION_ID }}" ]; then missing="$missing AZURE_SUBSCRIPTION_ID"; fi
          if [ -z "${{ secrets.AZURE_RESOURCE_GROUP }}" ]; then missing="$missing AZURE_RESOURCE_GROUP"; fi
          if [ -n "$missing" ]; then
            echo "::error::Missing required secrets:$missing"
            echo ""
            echo "Configure these secrets in GitHub: Settings > Secrets and variables > Actions"
            echo "See README.md for setup instructions."
            exit 1
          fi
          echo "âœ… All required secrets are configured"

  discover-content:
    name: Discover Exam Content
    needs: check-secrets
    runs-on: ubuntu-latest
    outputs:
      skillsOutline: ${{ steps.discover.outputs.skillsOutline }}
      sourceUrls: ${{ steps.discover.outputs.sourceUrls }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          cd src/pipeline
          pip install -r requirements.txt

      - name: Azure Login
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Resolve endpoints for latest deployment
        run: |
          set -euo pipefail
          chmod +x ./scripts/get-endpoints.sh

          suffix="${{ secrets.AZURE_UNIQUE_SUFFIX }}"
          if [[ -n "$suffix" ]]; then
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP" "$suffix")
          else
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP")
          fi

          echo "$out" | awk -F= '/^(OPENAI_ENDPOINT|SPEECH_ENDPOINT|DOCUMENT_INTELLIGENCE_ENDPOINT|SEARCH_ENDPOINT|COSMOS_DB_ENDPOINT|STORAGE_ACCOUNT_NAME)=/ {print $0}' >> "$GITHUB_ENV"

      - name: Ensure Cosmos SQL RBAC for this workflow principal
        run: |
          set -euo pipefail

          accessToken=$(az account get-access-token \
            --resource https://management.azure.com \
            --query accessToken -o tsv)
          export ACCESS_TOKEN="$accessToken"

          principalObjectId=$(python3 - <<'PY'
          import os, json, base64
          token = os.environ.get('ACCESS_TOKEN', '')
          parts = token.split('.')
          if len(parts) < 2:
            print('')
            raise SystemExit(0)
          payload = parts[1]
          payload += '=' * (-len(payload) % 4)
          data = base64.urlsafe_b64decode(payload.encode('utf-8')).decode('utf-8')
          claims = json.loads(data)
          print(claims.get('oid') or claims.get('objectId') or '')
          PY
          )

          if [[ -z "$principalObjectId" ]]; then
            echo "::warning::Could not determine automation principal objectId; skipping Cosmos SQL RBAC check."
            exit 0
          fi

          cosmosName=$(echo "$COSMOS_DB_ENDPOINT" | sed -E 's#^https?://([^./]+)\..*$#\1#')
          if [[ -z "$cosmosName" ]]; then
            echo "::error::Could not parse Cosmos account name from COSMOS_DB_ENDPOINT=$COSMOS_DB_ENDPOINT"
            exit 1
          fi

          existing=$(az cosmosdb sql role assignment list \
            --account-name "$cosmosName" \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --query "[?principalId=='$principalObjectId' && scope=='/dbs/certaudio'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            az cosmosdb sql role assignment create \
              --account-name "$cosmosName" \
              --resource-group "$AZURE_RESOURCE_GROUP" \
              --principal-id "$principalObjectId" \
              --scope "/dbs/certaudio" \
              --role-definition-id "00000000-0000-0000-0000-000000000002" \
              --only-show-errors
          fi

      - name: Discover exam content
        id: discover
        env:
          CERTIFICATION_ID: ${{ inputs.certificationId }}
          EXAM_PAGE_URL: ${{ inputs.examPageUrl }}
        run: |
          cd src/pipeline
          python3 -m tools.discover_exam_content \
            --certification-id "$CERTIFICATION_ID" \
            --exam-page-url "$EXAM_PAGE_URL" \
            --output-file /tmp/discovery_results.json
          
          echo "skillsOutline=$(cat /tmp/discovery_results.json | jq -c '.skillsOutline')" >> $GITHUB_OUTPUT
          echo "sourceUrls=$(cat /tmp/discovery_results.json | jq -c '.sourceUrls')" >> $GITHUB_OUTPUT

  index-content:
    name: Index Content for RAG
    runs-on: ubuntu-latest
    needs: discover-content
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          cd src/pipeline
          pip install -r requirements.txt

      - name: Azure Login
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Resolve endpoints for latest deployment
        run: |
          set -euo pipefail
          chmod +x ./scripts/get-endpoints.sh

          suffix="${{ secrets.AZURE_UNIQUE_SUFFIX }}"
          if [[ -n "$suffix" ]]; then
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP" "$suffix")
          else
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP")
          fi

          echo "$out" | awk -F= '/^(OPENAI_ENDPOINT|SPEECH_ENDPOINT|DOCUMENT_INTELLIGENCE_ENDPOINT|SEARCH_ENDPOINT|COSMOS_DB_ENDPOINT|STORAGE_ACCOUNT_NAME)=/ {print $0}' >> "$GITHUB_ENV"

      - name: Ensure Cosmos, Search, OpenAI, and Storage RBAC for this workflow principal
        run: |
          set -euo pipefail

          accessToken=$(az account get-access-token \
            --resource https://management.azure.com \
            --query accessToken -o tsv)
          export ACCESS_TOKEN="$accessToken"

          principalObjectId=$(python3 - <<'PY'
          import os, json, base64
          token = os.environ.get('ACCESS_TOKEN', '')
          parts = token.split('.')
          if len(parts) < 2:
            print('')
            raise SystemExit(0)
          payload = parts[1]
          payload += '=' * (-len(payload) % 4)
          data = base64.urlsafe_b64decode(payload.encode('utf-8')).decode('utf-8')
          claims = json.loads(data)
          print(claims.get('oid') or claims.get('objectId') or '')
          PY
          )

          if [[ -z "$principalObjectId" ]]; then
            echo "::warning::Could not determine automation principal objectId; skipping RBAC checks."
            exit 0
          fi
          echo "Principal objectId: $principalObjectId"

          # --- Cosmos SQL RBAC ---
          cosmosName=$(echo "$COSMOS_DB_ENDPOINT" | sed -E 's#^https?://([^./]+)\..*$#\1#')
          if [[ -z "$cosmosName" ]]; then
            echo "::error::Could not parse Cosmos account name from COSMOS_DB_ENDPOINT=$COSMOS_DB_ENDPOINT"
            exit 1
          fi

          existing=$(az cosmosdb sql role assignment list \
            --account-name "$cosmosName" \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --query "[?principalId=='$principalObjectId' && scope=='/dbs/certaudio'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            echo "Creating Cosmos SQL role assignment..."
            az cosmosdb sql role assignment create \
              --account-name "$cosmosName" \
              --resource-group "$AZURE_RESOURCE_GROUP" \
              --principal-id "$principalObjectId" \
              --scope "/dbs/certaudio" \
              --role-definition-id "00000000-0000-0000-0000-000000000002" \
              --only-show-errors
          else
            echo "Cosmos SQL RBAC already exists."
          fi

          # --- Azure AI Search RBAC ---
          searchName=$(echo "$SEARCH_ENDPOINT" | sed -E 's#^https?://([^./]+)\..*$#\1#')
          if [[ -z "$searchName" ]]; then
            echo "::error::Could not parse Search service name from SEARCH_ENDPOINT=$SEARCH_ENDPOINT"
            exit 1
          fi

          searchId=$(az resource show \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --name "$searchName" \
            --resource-type "Microsoft.Search/searchServices" \
            --query id -o tsv)

          if [[ -z "$searchId" ]]; then
            echo "::error::Could not resolve Search resource ID for $searchName"
            exit 1
          fi

          existing=$(az role assignment list \
            --assignee "$principalObjectId" \
            --scope "$searchId" \
            --query "[?roleDefinitionName=='Search Index Data Contributor'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            echo "Creating Search Index Data Contributor role assignment..."
            az role assignment create \
              --assignee-object-id "$principalObjectId" \
              --assignee-principal-type ServicePrincipal \
              --role "Search Index Data Contributor" \
              --scope "$searchId" \
              --only-show-errors

            # Role assignments can take a short time to propagate to the Search data plane.
            echo "Waiting 30s for RBAC propagation..."
            sleep 30
          else
            echo "Search RBAC already exists."
          fi

          # --- Azure OpenAI RBAC ---
          openAiName=$(echo "$OPENAI_ENDPOINT" | sed -E 's#^https?://([^./]+)\..*$#\1#')
          if [[ -z "$openAiName" ]]; then
            echo "::error::Could not parse OpenAI account name from OPENAI_ENDPOINT=$OPENAI_ENDPOINT"
            exit 1
          fi

          openAiId=$(az resource show \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --name "$openAiName" \
            --resource-type "Microsoft.CognitiveServices/accounts" \
            --query id -o tsv)

          if [[ -z "$openAiId" ]]; then
            echo "::error::Could not resolve OpenAI resource ID for $openAiName"
            exit 1
          fi

          existing=$(az role assignment list \
            --assignee "$principalObjectId" \
            --scope "$openAiId" \
            --query "[?roleDefinitionName=='Cognitive Services OpenAI User'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            echo "Creating Cognitive Services OpenAI User role assignment..."
            az role assignment create \
              --assignee-object-id "$principalObjectId" \
              --assignee-principal-type ServicePrincipal \
              --role "Cognitive Services OpenAI User" \
              --scope "$openAiId" \
              --only-show-errors

            # Role assignments can take a short time to propagate.
            echo "Waiting 30s for RBAC propagation..."
            sleep 30
          else
            echo "OpenAI RBAC already exists."
          fi

          # --- Azure Storage Blob RBAC ---
          storageId=$(az resource show \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --name "$STORAGE_ACCOUNT_NAME" \
            --resource-type "Microsoft.Storage/storageAccounts" \
            --query id -o tsv)

          if [[ -z "$storageId" ]]; then
            echo "::error::Could not resolve Storage resource ID for $STORAGE_ACCOUNT_NAME"
            exit 1
          fi

          existing=$(az role assignment list \
            --assignee "$principalObjectId" \
            --scope "$storageId" \
            --query "[?roleDefinitionName=='Storage Blob Data Contributor'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            echo "Creating Storage Blob Data Contributor role assignment..."
            az role assignment create \
              --assignee-object-id "$principalObjectId" \
              --assignee-principal-type ServicePrincipal \
              --role "Storage Blob Data Contributor" \
              --scope "$storageId" \
              --only-show-errors

            # Role assignments can take a short time to propagate.
            echo "Waiting 30s for RBAC propagation..."
            sleep 30
          else
            echo "Storage RBAC already exists."
          fi

      - name: Index content in AI Search
        env:
          SOURCE_URLS: ${{ needs.discover-content.outputs.sourceUrls }}
          CERTIFICATION_ID: ${{ inputs.certificationId }}
        run: |
          cd src/pipeline
          python3 -m tools.index_content \
            --certification-id "$CERTIFICATION_ID" \
            --source-urls "$SOURCE_URLS"

  generate-episodes:
    name: Generate Episodes
    runs-on: ubuntu-latest
    needs: [discover-content, index-content]
    strategy:
      matrix:
        batch: [0, 1, 2, 3, 4]  # Process in batches to avoid timeouts
      max-parallel: 2
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          cd src/pipeline
          pip install -r requirements.txt

      - name: Azure Login
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Resolve endpoints for latest deployment
        run: |
          set -euo pipefail
          chmod +x ./scripts/get-endpoints.sh

          suffix="${{ secrets.AZURE_UNIQUE_SUFFIX }}"
          if [[ -n "$suffix" ]]; then
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP" "$suffix")
          else
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP")
          fi

          echo "$out" | awk -F= '/^(OPENAI_ENDPOINT|SPEECH_ENDPOINT|DOCUMENT_INTELLIGENCE_ENDPOINT|SEARCH_ENDPOINT|COSMOS_DB_ENDPOINT|STORAGE_ACCOUNT_NAME)=/ {print $0}' >> "$GITHUB_ENV"

      - name: Generate episode batch
        env:
          CERTIFICATION_ID: ${{ inputs.certificationId }}
          AUDIO_FORMAT: ${{ inputs.audioFormat }}
          SKILLS_OUTLINE: ${{ needs.discover-content.outputs.skillsOutline }}
          BATCH_INDEX: ${{ matrix.batch }}
        run: |
          cd src/pipeline
          python3 -m tools.generate_episodes \
            --certification-id "$CERTIFICATION_ID" \
            --audio-format "$AUDIO_FORMAT" \
            --skills-outline "$SKILLS_OUTLINE" \
            --batch-index "$BATCH_INDEX" \
            --batch-size 10

  finalize:
    name: Finalize Content Generation
    runs-on: ubuntu-latest
    needs: generate-episodes
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Azure Login
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Resolve endpoints for latest deployment
        run: |
          set -euo pipefail
          chmod +x ./scripts/get-endpoints.sh

          suffix="${{ secrets.AZURE_UNIQUE_SUFFIX }}"
          if [[ -n "$suffix" ]]; then
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP" "$suffix")
          else
            out=$(./scripts/get-endpoints.sh "$AZURE_RESOURCE_GROUP")
          fi

          echo "$out" | awk -F= '/^(OPENAI_ENDPOINT|SPEECH_ENDPOINT|DOCUMENT_INTELLIGENCE_ENDPOINT|SEARCH_ENDPOINT|COSMOS_DB_ENDPOINT|STORAGE_ACCOUNT_NAME)=/ {print $0}' >> "$GITHUB_ENV"

      - name: Ensure Cosmos and Storage RBAC for this workflow principal
        run: |
          set -euo pipefail

          accessToken=$(az account get-access-token \
            --resource https://management.azure.com \
            --query accessToken -o tsv)
          export ACCESS_TOKEN="$accessToken"

          principalObjectId=$(python3 - <<'PY'
          import os, json, base64
          token = os.environ.get('ACCESS_TOKEN', '')
          parts = token.split('.')
          if len(parts) < 2:
            print('')
            raise SystemExit(0)
          payload = parts[1]
          payload += '=' * (-len(payload) % 4)
          data = base64.urlsafe_b64decode(payload.encode('utf-8')).decode('utf-8')
          claims = json.loads(data)
          print(claims.get('oid') or claims.get('objectId') or '')
          PY
          )

          if [[ -z "$principalObjectId" ]]; then
            echo "::warning::Could not determine automation principal objectId; skipping Cosmos SQL RBAC check."
            exit 0
          fi

          cosmosName=$(echo "$COSMOS_DB_ENDPOINT" | sed -E 's#^https?://([^./]+)\..*$#\1#')
          if [[ -z "$cosmosName" ]]; then
            echo "::error::Could not parse Cosmos account name from COSMOS_DB_ENDPOINT=$COSMOS_DB_ENDPOINT"
            exit 1
          fi

          existing=$(az cosmosdb sql role assignment list \
            --account-name "$cosmosName" \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --query "[?principalId=='$principalObjectId' && scope=='/dbs/certaudio'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            az cosmosdb sql role assignment create \
              --account-name "$cosmosName" \
              --resource-group "$AZURE_RESOURCE_GROUP" \
              --principal-id "$principalObjectId" \
              --scope "/dbs/certaudio" \
              --role-definition-id "00000000-0000-0000-0000-000000000002" \
              --only-show-errors
          fi

          # --- Azure Storage Blob RBAC ---
          storageId=$(az resource show \
            --resource-group "$AZURE_RESOURCE_GROUP" \
            --name "$STORAGE_ACCOUNT_NAME" \
            --resource-type "Microsoft.Storage/storageAccounts" \
            --query id -o tsv)

          if [[ -z "$storageId" ]]; then
            echo "::error::Could not resolve Storage resource ID for $STORAGE_ACCOUNT_NAME"
            exit 1
          fi

          existing=$(az role assignment list \
            --assignee "$principalObjectId" \
            --scope "$storageId" \
            --query "[?roleDefinitionName=='Storage Blob Data Contributor'] | length(@)" \
            -o tsv || echo "0")

          if [[ "$existing" == "0" ]]; then
            echo "Creating Storage Blob Data Contributor role assignment..."
            az role assignment create \
              --assignee-object-id "$principalObjectId" \
              --assignee-principal-type ServicePrincipal \
              --role "Storage Blob Data Contributor" \
              --scope "$storageId" \
              --only-show-errors

            echo "Waiting 30s for RBAC propagation..."
            sleep 30
          else
            echo "Storage RBAC already exists."
          fi

      - name: Generate episode index
        env:
          CERTIFICATION_ID: ${{ inputs.certificationId }}
          AUDIO_FORMAT: ${{ inputs.audioFormat }}
        run: |
          cd src/pipeline
          pip install -r requirements.txt
          python3 -m tools.generate_index \
            --certification-id "$CERTIFICATION_ID" \
            --audio-format "$AUDIO_FORMAT"

      - name: Output generation summary
        run: |
          echo "## Content Generation Complete! :headphones:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Setting | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| Certification | ${{ inputs.certificationId }} |" >> $GITHUB_STEP_SUMMARY
          echo "| Format | ${{ inputs.audioFormat }} |" >> $GITHUB_STEP_SUMMARY
